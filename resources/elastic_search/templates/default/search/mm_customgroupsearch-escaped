curl -XPOST "http://localhost:9200/_scripts/mm_customgroupsearch-escaped" -H 'Content-Type: application/json' -d'
{
  "template": "{\n\t \"query\": {\n\t   \"bool\": {\n\t\t \"must\": [\n\t\t   {{#origin}}\n\t\t   { \"term\": {\"sourceAuthority.origin.keyword\": \"{{origin}}\" }},\n\t\t   {{/origin}}\n\n\t\t   {{#agentId}}\n\t\t   { \"term\": {\"agents.id.keyword\": \"{{agentId}}\" }},\n\t\t   {{/agentId}}\n\n\t\t   {{#merchantType}}\n\t\t   { \"terms\": {\"type.keyword\": {{#toJson}}merchantType{{/toJson}} }},\n\t\t   {{/merchantType}}\n\n\t\t   {{#createdOnStartDateTime}}\n\t\t   {{#createdOnEndDateTime}}\n\t\t   { \"range\": {\"creationDate\": {\"gte\": \"{{createdOnStartDateTime}}\", \"lte\": \"{{createdOnEndDateTime}}\", \"format\": \"yyyy-MM-dd\"T\"HH:mm:ss\"Z\"\"} }},\n\t\t   {{/createdOnEndDateTime}}\n\t\t   {{/createdOnStartDateTime}}\n\n\t\t   {{#thirdParties}}\n\t\t   {\n\t\t\t \"bool\": {\n\t\t\t   \"should\": [\n\t\t\t\t {{#equifax}}\n\t\t\t     {\n\t\t\t\t   { \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.eqfId.keyword\" }},\n\t\t\t\t   { \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.eqfPassword.keyword\" }},\n\t\t\t\t   { \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.eqfProcessorId.keyword\" }}\n                 },\n\t\t\t\t {{/equifax}}\n\t\t\t\t \n\t\t\t\t {{#equifaxAcro}}\n\t\t\t\t {\n\t\t\t\t\t{ \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.eqfAcroCustomerNumber.keyword\" }},\n\t\t\t\t\t{ \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.eqfAcroSecurityCode.keyword\" }},\n\t\t\t\t\t{ \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.eqfAcroCustomerCode.keyword\" }}\n\t\t\t\t },\n\t\t\t\t {{/equifaxAcro}}\n\n\t\t\t\t {{#threatMetrix}}\n\t\t\t\t {\n\t\t\t\t\t{ \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.threatMetrixOrgId.keyword\" }},\n\t\t\t\t\t{ \"exists\": { \"field\": \"valueAddedServices.thirdPartyConfiguration.threatMetrixApiKey.keyword\" }}\n\t\t\t\t },\n\t\t\t\t {{/threatMetrix}}\n\t\t\t\t \n\t\t\t\t { \"exists\": { \"field\": \"type.keyword\" }}\n\t\t\t   ]\n\t\t\t }\n\t\t   },\n\t\t   {{/thirdParties}}\n\n\t\t   {\n\t\t\t \"nested\": {\n\t\t\t   \"path\": \"paymentAccounts\",\n\t\t\t   \"query\": {\n\t\t\t\t \"bool\": {\n\t\t\t\t   \"must\": [\n\t\t\t\t\t {{#paymentAccountId}}\n\t\t\t\t\t { \"terms\": {\"paymentAccounts.id.keyword\": {{#toJson}}paymentAccountId{{/toJson}} }},\n\t\t\t\t\t {{/paymentAccountId}}\n\n\t\t\t\t\t {{#paymentAccountIds}}\n\t\t\t\t\t { \"terms\": {\"paymentAccounts.id.keyword\": {{#toJson}}paymentAccountIds{{/toJson}} }},\n\t\t\t\t\t {{/paymentAccountIds}}\n\n\t\t\t\t\t {{#paymentAccountStatus}}\n\t\t\t\t\t { \"terms\": {\"paymentAccounts.status.keyword\": {{#toJson}}paymentAccountStatus{{/toJson}} }},\n\t\t\t\t\t {{/paymentAccountStatus}}\n\n\t\t\t\t\t {{#paymentAccountCurrency}}\n\t\t\t\t\t { \"terms\": {\"paymentAccounts.currency.keyword\": {{#toJson}}paymentAccountCurrency{{/toJson}} }},\n\t\t\t\t\t {{/paymentAccountCurrency}}\n\n\t\t\t\t\t {{#contactName}}\n\t\t\t\t\t { \"multi_match\": {\n\t\t\t\t\t\t \"query\": \"{{contactName}}\",\n\t\t\t\t\t\t \"fields\": [\"paymentAccounts.contacts.firstName.keyword\", \"paymentAccounts.contacts.lastName.keyword\"]\n\t\t\t\t\t   }\n\t\t\t\t\t },\n\t\t\t\t\t {{/contactName}}\n\n\t\t\t\t\t {{#contactEmails}}\n\t\t\t\t\t { \"terms\": {\"paymentAccounts.contacts.email.keyword\": {{#toJson}}contactEmails{{/toJson}} }},\n\t\t\t\t\t {{/contactEmails}}\n\n\t\t\t\t\t {\n\t\t\t\t\t   \"nested\": {\n\t\t\t\t\t\t \"path\": \"paymentAccounts.processingAccounts\",\n\t\t\t\t\t\t \"query\": {\n\t\t\t\t\t\t \"bool\": {\n\t\t\t\t\t\t   \"must\": [\n\t\t\t\t\t\t\t {{#merchantName}}\n\t\t\t\t\t\t\t { \"term\": {\"paymentAccounts.processingAccounts.businessDetails.tradeName.keyword\": \"{{merchantName}}\" }},\n\t\t\t\t\t\t\t {{/merchantName}}\n\n\t\t\t\t\t\t\t {{#merchantId}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.sourceAuthority.referenceId.keyword\": {{#toJson}}merchantId{{/toJson}} }},\n\t\t\t\t\t\t\t {{/merchantId}}\n\n\t\t\t\t\t\t\t {{#merchantIds}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.sourceAuthority.referenceId.keyword\": {{#toJson}}merchantIds{{/toJson}} }},\n\t\t\t\t\t\t\t {{/merchantIds}}\n\n\t\t\t\t\t\t\t {{#pmleId}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.pmleId.keyword\": {{#toJson}}pmleId{{/toJson}} }},\n\t\t\t\t\t\t\t {{/pmleId}}\n\n\t\t\t\t\t\t\t {{#pmleIds}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.pmleId.keyword\": {{#toJson}}pmleIds{{/toJson}} }},\n\t\t\t\t\t\t\t {{/pmleIds}}\n\n\t\t\t\t\t\t\t {{#processingAccountTypes}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.type.keyword\":  {{#toJson}}processingAccountTypes{{/toJson}} }},\n\t\t\t\t\t\t\t {{/processingAccountTypes}}\n\n\t\t\t\t\t\t\t {{#processingAccountId}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.id.keyword\": {{#toJson}}processingAccountId{{/toJson}} }},\n\t\t\t\t\t\t\t {{/processingAccountId}}\n\n\t\t\t\t\t\t\t {{#processingAccountIds}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.id.keyword\": {{#toJson}}processingAccountIds{{/toJson}} }},\n\t\t\t\t\t\t\t {{/processingAccountIds}}\n\n\t\t\t\t\t\t\t {{#merchantLegalEntityId}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.businessDetails.legalEntity.id.keyword\": {{#toJson}}merchantLegalEntityId{{/toJson}} }},\n\t\t\t\t\t\t\t {{/merchantLegalEntityId}}\n\n\t\t\t\t\t\t\t {{#merchantLegalEntityIds}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.businessDetails.legalEntity.id.keyword\": {{#toJson}}merchantLegalEntityIds{{/toJson}} }},\n\t\t\t\t\t\t\t {{/merchantLegalEntityIds}}\n\n\t\t\t\t\t\t\t {{#merchantLegalEntity}}\n\t\t\t\t\t\t\t { \"term\": {\"paymentAccounts.processingAccounts.businessDetails.legalEntity.description.keyword\": \"{{merchantLegalEntity}}\" }},\n\t\t\t\t\t\t\t {{/merchantLegalEntity}}\n\n\t\t\t\t\t\t\t {{#merchantLegalEntities}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.businessDetails.legalEntity.description.keyword\": {{#toJson}}merchantLegalEntities{{/toJson}} }},\n\t\t\t\t\t\t\t {{/merchantLegalEntities}}\n\n\t\t\t\t\t\t\t {{#accountGroups}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.businessDetails.accountGroups.keyword\": {{#toJson}}accountGroups{{/toJson}} }},\n\t\t\t\t\t\t\t {{/accountGroups}}\n\n\t\t\t\t\t\t\t {{#mccCode}}\n\t\t\t\t\t\t\t { \"term\": {\"paymentAccounts.processingAccounts.businessDetails.mcc.code.keyword\": \"{{mccCode}}\" }},\n\t\t\t\t\t\t\t {{/mccCode}}\n\n\t\t\t\t\t\t\t {{#accountManager}}\n\t\t\t\t\t\t\t { \"term\": {\"paymentAccounts.processingAccounts.businessDetails.onboardingInformation.accountManager.keyword\": \"{{accountManager}}\" }},\n\t\t\t\t\t\t\t {{/accountManager}}\n\n\t\t\t\t\t\t\t {{#partnerName}}\n\t\t\t\t\t\t\t { \"term\": {\"paymentAccounts.processingAccounts.businessDetails.onboardingInformation.partnerName.keyword\": \"{{partnerName}}\" }},\n\t\t\t\t\t\t\t {{/partnerName}}\n\n\t\t\t\t\t\t\t {{#partnerId}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.businessDetails.onboardingInformation.partnerId.keyword\": {{#toJson}}partnerId{{/toJson}} }},\n\t\t\t\t\t\t\t {{/partnerId}}\n\n\t\t\t\t\t\t\t {{#partnerIds}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.businessDetails.onboardingInformation.partnerId.keyword\": {{#toJson}}partnerIds{{/toJson}} }},\n\t\t\t\t\t\t\t {{/partnerIds}}\n\n\t\t\t\t\t\t\t {{#partnerProductName}}\n\t\t\t\t\t\t\t { \"term\": {\"paymentAccounts.processingAccounts.businessDetails.onboardingInformation.partnerProductName.keyword\": \"{{partnerProductName}}\" }},\n\t\t\t\t\t\t\t {{/partnerProductName}}\n\n\t\t\t\t\t\t\t {{#partnerProductId}}\n\t\t\t\t\t\t\t { \"term\": {\"paymentAccounts.processingAccounts.businessDetails.onboardingInformation.partnerProductId.keyword\": \"{{partnerProductId}}\" }},\n\t\t\t\t\t\t\t {{/partnerProductId}}\n\n\t\t\t\t\t\t\t {{#country}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.businessDetails.registeredAddress.country.keyword\": {{#toJson}}country{{/toJson}} }},\n\t\t\t\t\t\t\t {{/country}}\n\n\t\t\t\t\t\t\t {{#processingAccountStatus}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.status.code.keyword\": {{#toJson}}processingAccountStatus{{/toJson}} }},\n\t\t\t\t\t\t\t {{/processingAccountStatus}}\n\n\t\t\t\t\t\t\t {{#defaultBank}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.defaultBank.keyword\": {{#toJson}}defaultBank{{/toJson}} }},\n\t\t\t\t\t\t\t {{/defaultBank}}\n\n\t\t\t\t\t\t\t {{#processingAccountCurrency}}\n\t\t\t\t\t\t\t { \"terms\": {\"paymentAccounts.processingAccounts.currency.keyword\": {{#toJson}}processingAccountCurrency{{/toJson}} }},\n\t\t\t\t\t\t\t {{/processingAccountCurrency}}\n\t\t\t\t\t\t\t \n\t\t\t\t\t\t\t { \"exists\": { \"field\": \"paymentAccounts.processingAccounts.id\" }}\n\t\t\t\t\t\t]\n\t\t\t\t\t   }\n\t\t\t\t\t }\n\t\t\t\t   }\n\t\t\t\t }\n\t\t\t   ]\n\t\t\t }\n\t\t  }\n\t\t }\n\t   }\n\t ] }\n\t}\n\t{{#offset}}\n\t{{#limit}},\n\t\"from\" : \"{{offset}}\",\n\t\"size\" : \"{{limit}}\"\n\t{{/limit}}\n\t{{/offset}}\n\t}"
}'